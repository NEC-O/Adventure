# 故事管理功能测试文档

## 功能概述

已实现的故事管理功能包括：

### 1. 故事列表页面
- ✅ 显示所有创建的故事列表
- ✅ 显示故事的标题、创建时间、更新时间和状态
- ✅ 显示每个故事的节点数量
- ✅ 支持删除故事功能
- ✅ 支持跳转到故事编辑页面
- ✅ 支持开始游戏体验

### 2. 故事编辑页面
- ✅ 显示故事详细信息
- ✅ 支持编辑故事标题
- ✅ 可视化显示故事结构（节点树）
- ✅ 支持编辑节点内容
- ✅ 支持添加/删除节点选项
- ✅ 支持创建新节点
- ✅ 支持删除节点

### 3. 故事游戏体验增强
- ✅ 支持返回上一步功能
- ✅ 显示已访问的节点路径
- ✅ 支持点击节点跳转到任意已访问节点
- ✅ 支持从故事游戏直接跳转到编辑页面

### 4. 后端API
- ✅ 获取故事列表：`GET /api/stories/`
- ✅ 获取单个故事：`GET /api/stories/{story_id}`
- ✅ 更新故事信息：`PUT /api/stories/{story_id}`
- ✅ 删除故事：`DELETE /api/stories/{story_id}`
- ✅ 创建新节点：`POST /api/stories/{story_id}/nodes`
- ✅ 更新节点：`PUT /api/stories/{story_id}/nodes/{node_id}`
- ✅ 删除节点：`DELETE /api/stories/{story_id}/nodes/{node_id}`

## 测试步骤

### 1. 启动服务
```bash
# 启动后端
cd backend
python main.py

# 启动前端
cd frontend
npm run dev
```

### 2. 访问应用
打开浏览器访问：http://localhost:5173

### 3. 测试流程

#### 创建新故事
1. 在首页输入故事主题
2. 点击"生成故事"按钮
3. 等待故事生成完成

#### 管理故事
1. 点击导航栏的"故事管理"
2. 查看故事列表
3. 点击"编辑"按钮进入编辑页面
4. 在编辑页面可以：
   - 修改故事标题
   - 点击节点查看和编辑内容
   - 添加新节点
   - 删除节点
   - 修改节点选项

#### 体验故事
1. 在故事列表点击"开始游戏"
2. 在故事游戏中：
   - 选择不同的选项体验故事分支
   - 点击"返回上一步"回到上一个节点
   - 点击已访问的节点直接跳转
   - 点击"编辑故事"跳转到编辑页面

## 数据库结构

### 故事表 (stories)
- id: 主键
- title: 故事标题
- session_id: 会话ID
- created_at: 创建时间
- updated_at: 更新时间
- status: 状态 (draft/completed/failed)

### 故事节点表 (story_nodes)
- id: 主键
- story_id: 外键，关联故事
- content: 节点内容
- is_root: 是否根节点
- is_ending: 是否结局节点
- is_winning_ending: 是否胜利结局
- options: 选项列表（JSON格式）

## 注意事项

1. 所有API调用都需要包含session cookie
2. 故事数据按session隔离，不同用户只能看到自己的故事
3. 删除故事会同时删除所有关联的节点
4. 节点删除时会自动清理其他节点对该节点的引用